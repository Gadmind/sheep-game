# 🧪 如何测试金字塔堆叠

## 快速测试指南

---

## 🚀 第一步：刷新浏览器

```bash
按 Ctrl + F5 强制刷新
或直接刷新页面
```

---

## 🎮 第二步：开始新游戏

1. 点击"新游戏"按钮
2. 观察卡片布局

**你应该看到：**
- ✅ 顶层有一些可点击的卡片（彩色）
- ✅ 下层有很多灰色卡片（被压住）
- ✅ 可能有些卡片位置看起来有点"歪"（偏移卡片）

---

## 🔍 第三步：打开控制台

1. 按 `F12` 打开开发者工具
2. 切换到 `Console` 标签
3. 你会看到提示信息：
```
💡 调试工具已加载！
使用 debugCoverage() 查看覆盖统计
使用 debugOffsetCards() 查看偏移卡片
使用 debugCardCoverage("card-id") 查看特定卡片
```

---

## 📊 第四步：运行测试命令

### 测试1：覆盖统计
```javascript
debugCoverage()
```

**正常输出示例：**
```
=== 卡片覆盖关系调试 ===
总卡片: 96
可见: 24 (25.0%)
被覆盖: 72 (75.0%)
```

**判断：**
- ✅ 可见卡片占20-30%是正常的
- ❌ 如果可见卡片<10%或>50%，说明有问题

### 测试2：偏移卡片
```javascript
debugOffsetCards()
```

**正常输出示例：**
```
=== 偏移卡片统计 ===
偏移卡片数量: 18
总卡片数量: 96
偏移比例: 18.8%

前5个偏移卡片:
  card-5: 位置(1.5, 2.5), 层级3, 可见
  card-8: 位置(3.5, 4.5), 层级3, 可见
  card-12: 位置(2.5, 1.5), 层级2, 被覆盖
  ...
```

**判断：**
- ✅ 偏移卡片占15-30%是正常的
- ✅ 偏移卡片位置应该是小数（1.5, 2.5等）

---

## 🎯 第五步：实际游戏测试

### 测试A：点击可见卡片
1. 点击任意**彩色**（非灰色）卡片
2. **预期：** 卡片移入卡槽，游戏正常

### 测试B：点击灰色卡片
1. 尝试点击**灰色**卡片
2. **预期：** 无反应（不能点击）

### 测试C：移除上层卡片
1. 点击一张**偏移位置**的卡片（如果能识别）
2. **预期：** 下方2-4张卡片从灰色变为彩色
3. **预期：** 新显示的卡片可以点击

### 测试D：完整通关
1. 正常游戏，尽力完成
2. **预期：** 能够完全消除所有卡片

---

## 🔧 调试特定问题

### 问题：某张卡片无法点击

```javascript
// 1. 在游戏界面点击该卡片，记住它的符号
// 2. 在控制台查找该卡片
game.state.deck.filter(c => c && c.type === 0) // 替换0为卡片类型编号

// 3. 找到疑似的卡片ID，检查详情
debugCardCoverage('card-15') // 替换为实际ID
```

**输出会告诉你：**
- 卡片的位置
- 是否可见
- 被哪些卡片覆盖

---

## ✅ 成功标准

游戏正常工作的标志：

1. **可见性正确**
   - ✅ 彩色卡片可以点击
   - ✅ 灰色卡片不能点击
   - ✅ 移除上层后下层变可见

2. **覆盖关系合理**
   - ✅ 20-30%的卡片可见
   - ✅ 70-80%的卡片被覆盖
   - ✅ 偏移卡片15-30%

3. **游戏可玩**
   - ✅ 三消功能正常
   - ✅ 道具正常工作
   - ✅ 能够完全消除

4. **性能良好**
   - ✅ 点击响应快速
   - ✅ 动画流畅
   - ✅ 无卡顿现象

---

## 🐛 常见问题

### Q1: 控制台显示"卡片类型X数量不是3的倍数"
**A:** 这是正常的，游戏会自动修正。如果之后显示"牌堆调整完成，现在可以完全消除"，说明已经修复。

### Q2: 很多卡片都是灰色，可点击的很少
**A:** 这可能是正常的，随着游戏进行会逐渐露出更多卡片。如果顶层也都是灰色，说明覆盖检测有问题。

### Q3: 点击卡片后下方没有新卡片显示
**A:** 可能下方卡片仍然被其他上层卡片覆盖，这是正常的。

### Q4: 游戏无法完成
**A:** 如果确定不是策略问题，运行 `verifySolvability()` 检查可解性。

---

## 📞 获取帮助

如果测试后仍有问题：

1. **记录控制台输出**
   ```javascript
   debugCoverage()
   debugOffsetCards()
   ```

2. **截图游戏界面**
   - 显示问题的具体情况

3. **描述问题**
   - 什么情况下发生
   - 预期行为是什么
   - 实际行为是什么

4. **查看相关文档**
   - FIX_COVERAGE_DETECTION.md
   - PYRAMID_STACKING.md
   - BUGFIX_LOG.md

---

## 🎉 测试通过！

如果所有测试都通过，恭喜！游戏已经可以正常使用了！

**享受金字塔式堆叠的乐趣吧！** 🏔️

---

**测试指南版本：** v1.0  
**适用版本：** v2.0.3.1+  
**创建日期：** 2026-01-28

---

*测试让游戏更完美！* ✅
