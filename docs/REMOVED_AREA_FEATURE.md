# 🎮 移出区功能详解

## 功能概述

v2.0.3.4 增强了移出区功能，现在移出区的卡片可以点击移回卡槽，并且支持无限叠加。

---

## ✨ 核心特性

### 1. 卡片可移回 ⭐NEW
- ✅ 点击移出区卡片 → 移回卡槽
- ✅ 智能插入（相同类型聚集）
- ✅ 自动检查三消匹配
- ✅ 支持撤销操作

### 2. 无限叠加 ⭐NEW
- ✅ 移出区不再限制数量
- ✅ 多次使用移出道具会叠加
- ✅ 实时显示卡片总数
- ✅ 灵活管理

### 3. 可视化提示
- ✅ hover时放大和上浮
- ✅ 返回箭头图标
- ✅ "点击移回卡槽"提示
- ✅ 清晰的交互反馈

---

## 🎮 使用流程

### 场景1：移出卡片

```
步骤1：卡槽有卡片
卡槽：[🐑, 🌟, ⭐, 🌙, ☀️]
移出区：[空]

步骤2：使用移出道具
点击"移出"按钮
  ↓
卡槽：[🌙, ☀️]
移出区：[🐑, 🌟, ⭐]  ← 移到这里
```

### 场景2：叠加卡片

```
步骤1：移出区已有卡片
移出区：[🐑, 🌟, ⭐]

步骤2：再次使用移出道具
卡槽：[☁️, ❄️, 🔥]
点击"移出"按钮
  ↓
移出区：[🐑, 🌟, ⭐, ☁️, ❄️, 🔥]  ← 叠加
```

### 场景3：移回卡槽

```
步骤1：移出区有卡片
移出区：[🐑, 🌟, ⭐]

步骤2：点击移出区卡片
点击 🐑 卡片
  ↓
卡槽：[🐑]  ← 移回卡槽
移出区：[🌟, ⭐]  ← 剩余卡片
```

### 场景4：形成三消

```
步骤1：卡槽有2张🐑
卡槽：[🐑, 🐑, 🌟]

步骤2：移出区有1张🐑
移出区：[🐑, ⭐, 🌙]

步骤3：点击移出区的🐑
  ↓
卡槽：[🐑, 🐑, 🐑]  ← 自动三消！
移出区：[⭐, 🌙]
```

---

## 🎨 UI设计

### 移出区卡片样式

**正常状态：**
```
┌────┐
│ 🐑 │  红色边框
│    │  80%透明度
└────┘  ↩ 返回图标
```

**Hover状态：**
```
┌────┐
│ 🐑 │  放大1.1倍
│    │  上浮5px
└────┘  100%透明度
        ↩ 返回图标
        增强阴影
```

### 提示文字

```
移出区 3
点击卡片可移回卡槽  ← 提示文字
[🐑] [🌟] [⭐]
```

---

## 🔧 技术实现

### 1. 叠加机制

```javascript
// 移出道具使用
useRemoveTool() {
    // 移出前3张
    const cards = selectedCards.splice(0, 3);
    
    // 叠加到移出区（不限制数量）
    removedCards.push(...cards);
    
    // 更新计数
    removedCount = removedCards.length;
}
```

### 2. 移回机制

```javascript
// 点击移出区卡片
restoreCardFromRemoved(index) {
    // 检查卡槽是否满
    if (selectedCards.length >= maxSlot) {
        return;  // 不能移回
    }
    
    // 从移出区移除
    const card = removedCards.splice(index, 1)[0];
    
    // 智能插入卡槽（相同类型聚集）
    const insertIndex = findInsertPosition(card);
    selectedCards.splice(insertIndex, 0, card);
    
    // 检查三消
    checkForMatches();
}
```

### 3. 撤销支持

```javascript
// 撤销移回操作
if (lastMove.type === 'restore') {
    // 恢复卡槽状态
    selectedCards = lastMove.previousSelected;
    
    // 移回移出区
    removedCards.splice(lastMove.cardIndex, 0, lastMove.card);
}
```

---

## 📊 功能对比

### Before（v2.0.3.3）

| 特性 | 说明 |
|------|------|
| 移出区容量 | 最多3张 |
| 卡片操作 | 只能清空 |
| 移回功能 | ❌ 无 |
| 叠加功能 | ❌ 无 |

### After（v2.0.3.4）

| 特性 | 说明 |
|------|------|
| 移出区容量 | ✅ 无限叠加 |
| 卡片操作 | ✅ 可点击移回 |
| 移回功能 | ✅ 支持 |
| 叠加功能 | ✅ 支持 |

---

## 🎯 策略应用

### 策略1：临时存储

```
场景：卡槽快满，但需要等特定卡片
操作：
  1. 移出不重要的卡片
  2. 等待需要的卡片
  3. 点击移回需要的卡片
  4. 形成三消
```

### 策略2：卡片管理

```
场景：移出区有很多卡片
操作：
  1. 查看移出区卡片
  2. 选择需要的移回
  3. 不需要的保留
  4. 灵活应对
```

### 策略3：叠加利用

```
场景：多次使用移出道具
操作：
  1. 第一次移出：[A, B, C]
  2. 第二次移出：[D, E, F]
  3. 移出区：[A, B, C, D, E, F]
  4. 按需移回
```

---

## 🧪 测试用例

### 测试1：基本移回
```
操作：
1. 移出区有3张卡片
2. 点击第1张卡片

预期：
- 卡片移回卡槽 ✓
- 移出区剩2张 ✓
- 计数更新 ✓
```

### 测试2：叠加功能
```
操作：
1. 使用移出道具（移出3张）
2. 再次使用移出道具（移出3张）

预期：
- 移出区有6张 ✓
- 计数显示6 ✓
- 可以继续叠加 ✓
```

### 测试3：移回后三消
```
操作：
1. 卡槽有2张🐑
2. 移出区有1张🐑
3. 点击移出区的🐑

预期：
- 移回卡槽 ✓
- 自动三消 ✓
- 卡槽清空 ✓
```

### 测试4：卡槽满时
```
操作：
1. 卡槽有7张（已满）
2. 点击移出区卡片

预期：
- 提示"卡槽已满" ✓
- 卡片不移回 ✓
- 移出区不变 ✓
```

---

## 🎨 视觉设计

### 颜色系统

| 区域 | 背景 | 边框 | 卡片边框 |
|------|------|------|---------|
| 卡槽 | 灰白 | 灰色 | 白色 |
| 移出区 | 淡红 | 红色虚线 | 红色 |

### 交互反馈

**Hover效果：**
- 放大：scale(1.1)
- 上浮：translateY(-5px)
- 增强阴影
- 边框颜色变化

**点击反馈：**
- 卡片移回卡槽
- 显示成功消息
- 播放音效
- 自动检查匹配

---

## 📈 用户体验提升

### 控制权增强
- ✅ 可以自由选择移回哪些卡片
- ✅ 不需要的卡片可以保留
- ✅ 灵活应对游戏变化

### 策略性提升
- ✅ 移出区作为临时存储
- ✅ 可以规划卡片使用
- ✅ 增加游戏深度

### 操作便利性
- ✅ 点击即可移回
- ✅ 智能插入卡槽
- ✅ 自动检查匹配

---

## 🔄 完整操作流程

### 示例游戏

```
初始：
卡槽：[🐑, 🌟, ⭐, 🌙, ☀️, ☁️, ❄️]  ← 快满了
移出区：[空]

操作1：使用移出道具
  ↓
卡槽：[🌙, ☀️, ☁️, ❄️]
移出区：[🐑, 🌟, ⭐]

操作2：继续游戏，收集到2张🐑
  ↓
卡槽：[🌙, ☀️, 🐑, 🐑]
移出区：[🐑, 🌟, ⭐]

操作3：点击移出区的🐑
  ↓
卡槽：[🌙, ☀️]  ← 三消了！
移出区：[🌟, ⭐]

操作4：再次使用移出道具
  ↓
卡槽：[空]
移出区：[🌟, ⭐, 🌙, ☀️]  ← 叠加
```

---

## 💡 设计亮点

### 1. 无限叠加
- 不再限制3张
- 可以多次使用
- 灵活管理

### 2. 可移回
- 点击即可移回
- 智能插入
- 自动匹配

### 3. 视觉提示
- 返回箭头
- hover效果
- 提示文字

---

## 🎊 总结

### 核心改进
- ✨ 移出区卡片可点击移回
- ✨ 支持无限叠加
- ✨ 智能插入卡槽
- ✨ 完整的撤销支持

### 用户价值
- 更好的控制权
- 更灵活的策略
- 更便利的操作
- 更深的游戏性

---

**功能版本：** v2.0.3.4  
**更新日期：** 2026-01-28

---

*移出区，让卡片管理更灵活！* 🎮
