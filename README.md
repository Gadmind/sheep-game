# 🐑 羊了个羊 - 完整实现版

一个基于HTML5、CSS3和JavaScript实现的《羊了个羊》游戏，具有完整的游戏机制、道具系统和数据持久化功能。

---

## ⚡ 快速启动

### 🎯 Windows用户（最简单）

**双击运行任一文件：**
- `scripts/start.bat` - 自动检测环境（推荐）
- `scripts/start-python.bat` - 使用Python
- `scripts/start-node.bat` - 使用Node.js
- `scripts/start-simple.bat` - 简单Python服务器

### 🖥️ 命令行启动

```bash
# 使用Python（推荐）
python server.py

# 使用Node.js
node server.js

# 或使用简单命令
python -m http.server 8000
```

**访问地址：** `http://localhost:8000`

### 💡 更多方式

详细说明请查看：
- **docs/START_HERE.txt** - 极简英文说明
- **docs/START_SERVER.md** - 完整启动指南
- **docs/本地运行指南.md** - 中文指南

---

## ✨ 特性

### 🎮 核心功能
- **金字塔式堆叠系统** 🏔️HOT - 卡片可半格偏移，一张压多张，模拟真实堆叠
- **多层卡片系统** - 支持多层卡片叠加，模拟真实的3D堆叠效果
- **矩形重叠检测** - 使用区域覆盖算法，精确判断卡片覆盖关系
- **三消匹配机制** - 经典的三消玩法，自动检测和消除匹配的卡片
- **100%可解性保证** 🔥HOT - 彻底解决无法完全消除的问题，确保每局都能通关
- **智能卡片分组** ⭐NEW - 相同类型卡片自动聚集，更易形成三消
- **自动验证修正** - 生成后自动验证并修正，保证卡片数量正确

### 🔧 道具系统
- **移出道具** ⭐NEW - 将卡槽前三张移到移出区暂存（3次），支持叠加，点击移出区卡片可移回卡槽
- **撤销道具** - 回退上一步操作（3次）
- **洗牌道具** - 重新排列可见卡片（1次）
- **提示道具** - 高亮显示可消除的卡片（3次）

### 💾 数据持久化
- **最高分记录** - 自动保存和显示最高分
- **游戏统计** - 记录游戏次数、胜率和总分
- **设置保存** - 保存音效开关和游戏偏好
- **本地存储** - 使用localStorage实现数据持久化

### 🎨 用户体验
- **自适应网格布局** 🔥HOT - 7列9行智能网格，完美适配所有屏幕
- **响应式设计** - 适配手机、平板和桌面设备，自动调整卡片尺寸
- **流畅动画** - 卡片移动、消除和UI交互动画
- **智能视觉分组** ⭐NEW - 相同卡片自动靠近，形成视觉聚类
- **即时反馈** - 新添加的卡片高亮显示，操作即时可见
- **视觉反馈** - 卡槽警告状态、高亮提示等
- **现代UI** - 渐变色彩、圆角设计、阴影效果

## 🚀 快速开始

### 🎯 方法1：一键启动（推荐）

**Windows用户：**
```bash
双击运行 scripts/start.bat 文件
```
- ✅ 自动检测环境（Python/Node.js）
- ✅ 自动启动服务器
- ✅ 自动打开浏览器
- ✅ 最简单快捷！

### 🐍 方法2：Python服务器

```bash
# 使用提供的服务器脚本（推荐）
python server.py

# 或使用Python内置模块
python -m http.server 8000
```

然后访问：`http://localhost:8000`

### 📦 方法3：Node.js服务器

```bash
# 使用提供的服务器脚本（推荐）
node server.js

# 或使用npm命令
npm start

# 或使用npx（无需安装）
npx live-server --port=8000
```

然后访问：`http://localhost:8000`

### 🖥️ 方法4：VS Code Live Server

1. 安装 Live Server 扩展
2. 右键点击 `index.html`
3. 选择 "Open with Live Server"
4. 自动打开浏览器

### 💡 方法5：直接打开（最简单）

```bash
# 直接双击 index.html 文件
# 或在命令行
start index.html  # Windows
```

**注意：** 推荐使用服务器方式以获得最佳体验

详细说明请查看 **docs/START_SERVER.md**

## 🎯 游戏规则

### 基本玩法
1. **点击卡片** - 点击牌堆顶部的可见卡片
2. **卡片移动** - 被点击的卡片会移动到下方的卡槽
3. **三消匹配** - 当卡槽中有3张相同的卡片时，它们会自动消除
4. **获胜条件** - 消除所有卡片即可获胜
5. **失败条件** - 卡槽填满（7张不同的卡）且无法三消时游戏失败

### 难度设置
游戏支持三种难度（可在代码中配置）：
- **简单** - 3层，9张/类型，9个卡槽
- **普通** - 4层，12张/类型，7个卡槽（默认）
- **困难** - 5层，15张/类型，7个卡槽

### 游戏技巧
- 👁️ 优先消除上层卡片，让下层卡片尽快露出
- 🧠 注意观察卡片堆叠情况，规划消除顺序
- 📦 不要急于填满卡槽，预留空间应对意外
- 🛠️ 合理使用道具，关键时刻可以扭转局势
- 💡 使用提示道具来发现隐藏的消除机会

## 📁 项目结构

```
sheep-game/
├── index.html          # 主HTML文件，包含游戏结构
├── style.css           # 样式文件，包含所有UI样式和动画
├── script.js           # 游戏逻辑，包含核心算法和交互
├── server.js           # Node.js 服务器
├── server.py           # Python 服务器
├── package.json        # 项目配置
├── README.md           # 项目文档
├── docs/               # 文档目录
│   ├── START_HERE.txt
│   ├── START_SERVER.md
│   └── ... (其他文档)
└── scripts/            # 启动脚本目录
    ├── start.bat
    ├── start-node.bat
    ├── start-python.bat
    └── start-simple.bat
```

## 🔨 技术栈

- **HTML5** - 语义化标签，无框架依赖
- **CSS3** - Flexbox布局、CSS变量、动画和渐变
- **JavaScript (ES6+)** - 类、箭头函数、解构赋值等现代特性
- **Font Awesome** - 图标库
- **Google Fonts** - 自定义字体

## 💡 核心算法

### 卡片生成算法
```javascript
// 1. 生成卡片组（每组3张相同类型）
// 2. 随机洗牌
// 3. 从顶层到底层逐层放置
// 4. 确保每组3张卡片可以被找到
// 5. 动态计算卡片可见性
```

### 可见性检测
```javascript
// 对每个位置，从顶层向下扫描
// 找到第一张未被更上层覆盖的卡片
// 该卡片即为可点击的可见卡片
```

### 三消检测
```javascript
// 按类型分组统计卡槽中的卡片
// 当某个类型数量≥3时触发消除
// 移除最早加入的3张，加分100
```

## 🎨 优化亮点

### 性能优化
- ✅ 使用 `DocumentFragment` 批量操作DOM，减少重排重绘
- ✅ 合理使用CSS动画替代JavaScript动画
- ✅ 事件委托减少事件监听器数量
- ✅ 防抖和节流处理高频操作

### 代码优化
- ✅ 模块化设计，职责分离（存储管理、性能工具）
- ✅ 工具类封装常用功能
- ✅ 详细的代码注释和文档
- ✅ 易于扩展的配置系统

### 用户体验优化
- ✅ 本地存储保存进度和设置
- ✅ 流畅的动画和过渡效果
- ✅ 清晰的视觉反馈（警告、危险状态）
- ✅ 响应式布局适配多种设备

## 🔧 配置选项

在 `script.js` 中的 `CONFIG` 对象可以自定义游戏参数：

```javascript
const CONFIG = {
    layers: 4,           // 层数
    rows: 7,             // 每层行数
    cols: 8,             // 每层列数
    cardTypes: 8,        // 卡片类型数量
    cardsPerType: 12,    // 每种类型的卡片数量
    maxSlot: 7,          // 卡槽最大容量
    // ... 更多配置
};
```

## 🐛 已知问题

- 音效系统仅为模拟实现，需要添加实际音频文件
- 移动端触摸优化可以进一步改进
- 部分极端情况下可能生成无解的布局

## 🔮 未来计划

- [ ] 添加关卡系统和进度保存
- [ ] 实现真实的音效系统
- [ ] 添加在线排行榜
- [ ] 支持自定义主题和皮肤
- [ ] 添加社交分享功能
- [ ] 多语言支持
- [ ] 游戏回放功能

## 📝 更新日志

### v2.0.3.4 (移出区增强版) ⭐NEW
- 🎮 **移出区功能增强**
  - 移出区卡片可点击移回卡槽
  - 支持无限叠加（不再限制3张）
  - 智能插入卡槽（相同类型聚集）
  - 移回后自动检查三消匹配
  - 完整的撤销支持

### v2.0.3.3 (移出道具优化版)
- 🎮 **改进移出道具功能**
  - 卡片移到独立移出区域而非直接消除
  - 新增移出区UI显示（红色主题）
  - 新增清空移出区按钮
  - 支持撤销和恢复操作

### v2.0.3 (自适应布局版) 🔥HOT
- 🎨 **7列9行自适应网格布局**
  - 卡片显示区完全重构
  - 新增 `calculateCardLayout()` 动态布局计算
  - 根据容器大小自动调整卡片尺寸
  - 支持窗口大小改变时实时重新布局
  - 完美适配所有设备和屏幕尺寸

### v2.0.2 (可解性保证版) 🔥HOT
- 🎯 **核心算法重构 - 彻底解决无法完全消除的问题**
  - 完全重写卡片生成算法
  - 新增可解性验证和自动修正机制
  - 确保每种卡片类型数量都是3的倍数
  - **保证100%可以完全消除，不再有死局！**
- 📚 新增 docs/SOLVABILITY_ALGORITHM.md 算法详解文档

### v2.0.1 (智能分组版) ⭐NEW
- ✨ 新增智能卡片分组功能
  - 相同类型的卡片自动聚集在一起
  - 新增 `findInsertPosition()` 智能插入算法
  - 视觉分组效果，相同卡片自动靠近
- 🐛 修复点击卡片后卡槽不显示的问题
- 🐛 修复游戏规则弹窗被卡片遮挡的z-index问题
- 🎨 优化卡槽视觉效果，新卡片高亮显示
- 📚 新增 docs/BUGFIX_LOG.md 和 docs/FEATURE_SMART_GROUPING.md 文档

### v2.0.0 (优化版)
- ✨ 新增本地存储和数据持久化
- ⚡ 性能优化：使用DocumentFragment批量渲染
- 🎨 UI优化：添加更多动画和视觉反馈
- 🔧 代码重构：模块化设计和工具类封装
- 📚 完善项目文档和注释

### v1.0.0 (初始版本)
- 🎮 实现基本游戏功能
- 🔧 添加四种道具系统
- 🎨 实现响应式UI设计
- 📱 支持移动端和桌面端

## 📄 许可证

本项目仅供学习和研究使用。如果你觉得有帮助，欢迎点赞和分享！

## 🤝 贡献

欢迎提交Issue和Pull Request！

## 👨‍💻 作者

基于HTML5、CSS3和JavaScript实现

---

**享受游戏！如果你喜欢这个项目，请给它一个⭐**
